@using Microsoft.AspNetCore.Identity
@inject UserManager<ApplicationUser> UserManager

@{
    var userId = UserManager.GetUserId(User);
    var isFavorite = ViewBag.HasFavorite != null && ViewBag.HasFavorite == true;
}
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600&display=swap" rel="stylesheet" />
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Your Page Title</title>
    <!-- Thêm liên kết tới Font Awesome nếu chưa có -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <!-- Thêm Bootstrap CSS nếu chưa có -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

    <style>
        /* General Page Styling */
        body {
            font-family: 'Manrope', sans-serif;
            color: #333;
        }

        /* Responsive Design */
        @@media (max-width: 768px) {
            .single-slider {
                padding: 100px 0;
            }

            .hero-cap h2 {
                font-size: 32px;
            }

            .job-tittle h4 {
                font-size: 28px;
            }

            .apply-btn2 a.btn {
                font-size: 18px;
                padding: 10px 40px;
            }

            .job-post-details,
            .category-info,
            .related-jobs,
            .post-details4 {
                padding: 25px;
            }
        }

        /* Card container */
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 25px;
            background-color: #007bff;
            color: #fff;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            border-radius: 12px 12px 0 0;
        }

        .card-header .card-title {
            font-size: 18px;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
        }

        .btn-secondary {
            color: #fff !important;
            background-color: #48b0f7;
            border-color: #48b0f7;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
        }

        .btn-danger {
            border-radius: 20px;
            padding: 6px 12px;
        }

        .ps-container {
            position: relative;
            overflow: auto;
            height: 400px;
            background-color: #f9f9f9;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 10px;
        }

        /* Chat bubbles */
        .media-chat {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .media-chat-reverse {
            flex-direction: row-reverse;
        }

        #chatModal {
            /* background: linear-gradient(135deg, #e74c3c, #ff6b81, #f1c40f, #2ecc71, #3498db, #9b59b6, #34495e); */
        }

        .avatar {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            margin-right: 15px;
            object-fit: cover;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .media-body {
            background-color: #E0E0E0;
            border-radius: 20px;
            padding: 10px 20px;
            max-width: 50%;
            font-family: 'Roboto', sans-serif;
            font-size: 14px;
            color: #333;
            position: relative;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            margin-right: 10px;
        }

        .media-chat-reverse .media-body {
            background-color: #E0E0E0;
            color: #fff;
        }

        .media-body p {
            word-wrap: break-word;
            overflow-wrap: break-word;
            margin: 0;
            padding: 0;
            white-space: normal;
        }

        .media-body .meta {
            font-size: 12px;
            margin-top: 5px;
            opacity: 0.8;
        }

        /* Day separator */
        .media-meta-day {
            display: flex;
            justify-content: center;
            align-items: center;
            color: #8b95a5;
            font-weight: 500;
            font-size: 13px;
            opacity: 0.8;
            margin: 20px 0;
        }

        .media-meta-day::before,
        .media-meta-day::after {
            content: '';
            flex: 1 1;
            border-top: 1px solid #ebebeb;
            margin: 0 10px;
        }

        /* Input area */
        .publisher {
            display: flex;
            align-items: center;
            padding: 15px;
            background-color: #f1f3f5;
            border-top: 1px solid #ebebeb;
            border-radius: 0 0 12px 12px;
        }

        .publisher-input {
            flex-grow: 1;
            border-radius: 30px;
            padding: 12px 20px;
            border: none;
            background-color: #ffffff;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            outline: none;
            font-family: 'Roboto', sans-serif;
        }

        .publisher-btn {
            background-color: transparent;
            border: none;
            font-size: 18px;
            color: #8b95a5;
            margin-left: 10px;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }

        .publisher-btn:hover {
            color: #007bff;
        }

        .file-group input[type="file"] {
            position: absolute;
            opacity: 0;
            z-index: -1;
            width: 20px;
        }

        .text-info {
            color: #48b0f7 !important;
        }

        /* Style for the Employer Information Modal */
        .modal-content {
            background-color: transparent;
            border: none;
        }

        .modal-contentEmployer {
            background-color: #ffff;
        }

        /* Modal Styling */
        .modal-contentEmployer {
            border-radius: 8px;
            overflow: hidden;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
        }

        .modal-header {
            background-color: #007bff;
            color: #fff;
            padding: 15px;
            font-size: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-weight: bold;
        }

        .modal-bodyEmployer {
            padding: 20px;
        }

        .modal-bodyEmployer h5 {
            color: #333;
            font-size: 20px;
            margin-bottom: 10px;
        }

        .modal-bodyEmployer p {
            margin: 5px 0;
            font-size: 15px;
            color: #555;
        }

        .modal-bodyEmployer p strong {
            color: #333;
        }

        .employer-logo {
            width: 100px;
            height: auto;
            border-radius: 6px;
            margin-top: 15px;
        }

        /* Default styling for the close button */
        .modal-header .close {
            color: #fff !important;
            font-size: 1.5rem;
            transition: color 0.3s ease;
        }

        /* Hover effect */
        .modal-header .close:hover {
            color: #e74c3c !important;
            cursor: pointer;
        }

        /* Basic styling for social links */
        .social-links-container .social-link {
            width: 40px;
            height: 40px;
            color: #fff;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            text-decoration: none;
        }

        /* Hover effect */
        .social-links-container .social-link:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            text-decoration: none;
        }

        /* Individual social media colors */
        .bg-facebook {
            background-color: #3b5998;
        }

        .bg-twitter {
            background-color: #1da1f2;
        }

        .bg-linkedin {
            background-color: #0077b5;
        }

        .bg-instagram {
            background-color: #e4405f;
        }

        .job-list-container {
            padding: 20px;
            background-color: #f4f6f9;
            border-radius: 10px;
            box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.1);
        }

        .job-list-container h6 {
            color: #2c3e50;
            font-size: 1.3rem;
        }

        .job-cards {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .job-card {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 3px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 20px;
        }

        .job-card:hover {
            transform: translateY(-5px);
        }

        .job-card-icon {
            font-size: 2rem;
            color: #3498db;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 60px;
            min-height: 60px;
            background-color: #ecf5fd;
            border-radius: 50%;
        }

        .job-card-content {
            flex-grow: 1;
        }

        .job-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: #2c3e50;
            margin: 0;
        }

        .job-details {
            margin-top: 8px;
            font-size: 0.95rem;
            color: #6c757d;
        }

        .job-salary {
            font-size: 1rem;
            font-weight: bold;
            color: #28a745;
        }

        .job-address,
        .job-working-time {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 4px;
        }

        /* Remove underline and set default color for the link */
        .job-card-link {
            text-decoration: none;
            color: inherit;
            display: block;
        }

        .job-card-link:hover {
            text-decoration: none;
        }

        /* Add a hover effect to the job card without underline */
        .job-card-link:hover .job-card {
            transform: translateY(-5px);
            box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.15);
        }

        .section-header {
            font-size: 1.15rem;
            font-weight: 600;
            color: #C3171C;
            position: relative;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }

        .section-header::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 200px;
            height: 3px;
            background-color: #C3171C;
            border-radius: 2px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .section-header:hover::after,
        .section-header:focus::after {
            opacity: 1;
        }

        .modal-body {
            background-color: #fdfdfd;
            border-radius: 0 0 8px 8px;
            box-shadow: inset 0px -1px 8px rgba(0, 0, 0, 0.05);
        }

        .social-link {
            width: 40px;
            height: 40px;
            color: white;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .social-link:hover {
            transform: scale(1.1);
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
        }

        #employerLogo {
            transition: transform 0.3s ease;
        }

        #employerLogo:hover {
            transform: scale(1.05);
        }

        .card {
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        /* Custom Button Styling */
        .btn-custom {
            font-size: 16px;
            padding: 12px 20px;
            border-radius: 8px;
        }

        /* Hover Effects for Buttons */
        .btn-success:hover {
            background-color: #218838;
            border-color: #1e7e34;
        }

        .btn-outline-danger:hover {
            background-color: #dc3545;
            color: #fff;
        }

        .btn-outline-info:hover {
            background-color: #17a2b8;
            color: #fff;
        }

        .job-header{
            background: none;
        }

        @@keyframes blinkEffect {
        0%, 100% {
            text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.8), 0 0 10px rgba(255, 255, 255, 0.8);
        }
        50% {
            text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.3), 0 0 10px rgba(255, 255, 255, 0.3);
        }
    }

    .blinking-title {
        animation: blinkEffect 1.5s infinite;
        color: white; /* Màu chữ */
        font-size: 48px;
        font-weight: 700;
    }

    </style>
</head>
<body>
    <main>
        <!-- Job Header -->
        <section class="job-header" style="background: url('/img/hero/about4.jpg') no-repeat center center; background-size: cover; position: relative; color: #fff; padding: 100px 0; text-align: center;">
            <div class="container-fluid" style="position: relative; z-index: 1;">
                <h1 class="blinking-title" style="font-size: 48px; font-weight: 700; color: white;">@Model.JobTitle</h1>
            </div>
            <div style="content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6);"></div>
        </section>

        <!-- Main Content -->
        <div class="container-xl my-5">
            <div class="row">
                <!-- Left Column -->
                <div class="col-lg-7 col-md-8 col-sm-12 job-details">
                    <!-- Job Details Card -->
                    <div class="job-card" style="border: none; border-radius: 10px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); overflow: hidden; margin-bottom: 30px;">
                        <div class="job-card-body" style="padding: 20px;">
                            <div class="job-details" style="display: flex; align-items: center;">
                                <div class="job-logo" style="margin-right: 20px; flex-shrink: 0;">
                                    @if (Model.CompanyLogo != null && Model.CompanyLogo.Length > 0)
                                    {
                                        <img src="data:image/png;base64,@Convert.ToBase64String(Model.CompanyLogo)" alt="Logo Công Ty" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 2px solid #ddd;">
                                    }
                                    else
                                    {
                                        <img src="/img/logo/DefaultLogo.png" alt="Logo Công Ty Mặc Định" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 2px solid #ddd;">
                                    }
                                </div>
                                <div class="job-info" style="flex-grow: 1;">
                                    <h3 style="margin-bottom: 10px; font-size: 28px; color: #333;">@Model.JobTitle</h3>
                                    <p style="margin-bottom: 5px;">
                                        <strong>
                                            <a href="#" data-toggle="modal" data-target="#employerInfoModalRenamed" onclick="loadEmployerInfo('@Model.EmployerId')" style="color: #007bff; text-decoration: none; font-size: 20px;">
                                                @Model.CompanyName
                                            </a>
                                        </strong>
                                    </p>
                                    <p style="margin-bottom: 5px; color: #6c757d; font-size: 16px;">
                                        <i class="fas fa-map-marker-alt" style="color: #dc3545;"></i> @Model.District, @Model.Ward
                                    </p>
                                    <p style="margin-bottom: 0; font-weight: bold; color: #28a745; font-size: 18px;">
                                        Mức lương: @Model.SalaryMin.ToString("C0", new System.Globalization.CultureInfo("vi-VN")) -
                                        @Model.SalaryMax.ToString("C0", new System.Globalization.CultureInfo("vi-VN"))
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Job Post Details -->
                    <div class="job-post-details">
                        <!-- Mô tả công việc -->
                        <div class="post-details2 mb-50" style="margin-bottom: 30px; background-color: #FFFFFF; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <div class="small-section-title" style="margin-bottom: 15px;">
                                <h4 style="font-size: 26px; font-weight: bold; color: #333;">📝 Mô tả công việc</h4>
                            </div>
                            <div style="line-height: 2; color: #555; font-size: 18px;">
                                @Html.Raw(Model.JobDescription)
                            </div>
                        </div>

                        <!-- Kiến thức, kỹ năng và khả năng yêu cầu -->
                        <div class="post-details2 mb-50" style="margin-bottom: 30px; background-color: #FFFFFF; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <div class="small-section-title" style="margin-bottom: 15px;">
                                <h4 style="font-size: 26px; font-weight: bold; color: #333;">💡 Kiến thức, kỹ năng và khả năng yêu cầu</h4>
                            </div>
                            <div style="line-height: 2; color: #555; font-size: 18px;">
                                @Html.Raw(Model.JobRequirements)
                            </div>
                        </div>

                        <!-- Trình độ học vấn và kinh nghiệm -->
                        <div class="post-details2 mb-50" style="margin-bottom: 30px; background-color: #FFFFFF; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <div class="small-section-title" style="margin-bottom: 15px;">
                                <h4 style="font-size: 26px; font-weight: bold; color: #333;">🎓 Trình độ học vấn và kinh nghiệm</h4>
                            </div>
                            <div style="line-height: 2; color: #555; font-size: 18px;">
                                @if (!string.IsNullOrEmpty(Model.Education))
                                {
                                    @Html.Raw(Model.Education)
                                }
                                else
                                {
                                    <p style="color: #777;">Không có yêu cầu công việc nào được cung cấp.</p>
                                }
                            </div>
                        </div>

                        <!-- Phúc lợi -->
                        <div class="post-details2 mb-50" style="margin-bottom: 30px; background-color: #FFFFFF; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <div class="small-section-title" style="margin-bottom: 15px;">
                                <h4 style="font-size: 26px; font-weight: bold; color: #333;">🎁 Phúc lợi</h4>
                            </div>
                            <div style="line-height: 2; color: #555; font-size: 18px;">
                                @if (!string.IsNullOrEmpty(Model.Benefits))
                                {
                                    @Html.Raw(Model.Benefits)
                                }
                                else
                                {
                                    <p style="color: #777;">Không có thông tin về phúc lợi.</p>
                                }
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div class="col-lg-5 col-md-4 col-sm-12 sidebar">
                    <!-- Tóm tắt công việc -->
                    <div class="card" style="margin-bottom: 30px; border: none; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
                        <div class="card-body" style="padding: 20px;">
                            <h4 style="font-size: 24px; font-weight: bold; color: #333;">📋 Tóm tắt công việc</h4>
                            <ul style="list-style: none; padding: 0; color: #555; font-size: 16px;">
                                <li style="margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
                                    <span><strong><i class="fas fa-calendar-alt" style="color: #000;"></i> Ngày đăng:</strong></span>
                                    <span>@Model.CreationDate.ToString("d")</span>
                                </li>
                                <li style="margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
                                    <span><strong><i class="fas fa-briefcase" style="color: #000;"></i> Loại công việc:</strong></span>
                                    <span>Bán thời gian</span>
                                </li>
                                <li style="margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
                                    <span><strong><i class="fas fa-users" style="color: #000;"></i> Số lượng tuyển:</strong></span>
                                    <span>@Model.HiringQuantity</span>
                                </li>
                                <li style="margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
                                    <span><strong><i class="fas fa-venus-mars" style="color: #000;"></i> Giới tính:</strong></span>
                                    <span>@Model.Gender</span>
                                </li>
                                <li style="margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
                                    <span><strong><i class="fas fa-money-bill-wave" style="color: #000;"></i> Mức lương:</strong></span>
                                    <span>
                                        @Model.SalaryMin.ToString("C0", new System.Globalization.CultureInfo("vi-VN"))
                                        -
                                        @Model.SalaryMax.ToString("C0", new System.Globalization.CultureInfo("vi-VN"))
                                    </span>
                                </li>
                                <li style="margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
                                    <span><strong><i class="fas fa-clock" style="color: #000;"></i> Thời gian làm việc:</strong></span>
                                    <span>@Model.WorkingTime</span>
                                </li>
                                <li style="margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
                                    <span><strong><i class="fas fa-map-marker-alt" style="color: #000;"></i> Địa điểm:</strong></span>
                                    <span>@Model.Address</span>
                                </li>
                            </ul>
                            <div style="margin-top: 20px;">
                                @if (ViewBag.HasApplied)
                                {
                                    <button class="btn btn-secondary btn-custom" style="width: 100%; margin-bottom: 10px;" disabled>Đã ứng tuyển</button>
                                }
                                else if (ViewBag.HasCancelled)
                                {
                                    <a asp-action="Apply" asp-route-id="@Model.Id" class="btn btn-success btn-custom" style="width: 100%; margin-bottom: 10px;">Ứng tuyển lại</a>
                                }
                                else
                                {
                                    @if (!User.IsInRole("Employer"))
                                    {
                                        <a asp-action="Apply" asp-route-id="@Model.Id" class="btn btn-success btn-custom" style="width: 100%; margin-bottom: 10px;">Ứng tuyển ngay</a>
                                    }
                                }

                                <button id="favoriteButton"
                                        class="btn btn-custom @(!isFavorite ? "btn-outline-danger" : "btn-outline-success")"
                                        style="width: 100%; margin-bottom: 10px;"
                                        onclick="toggleFavorite(@Model.Id)">
                                    <i class="fas fa-heart @(!isFavorite ? "far" : "fas")"></i>
                                    @if (isFavorite)
                                    {
                                        <text>Đã thêm vào danh sách yêu thích</text>
                                    }
                                    else
                                    {
                                        <text>Thêm vào danh sách yêu thích</text>
                                    }
                                </button>

                                @if (string.IsNullOrEmpty(userId))
                                {
                                    <a href="/Identity/Account/Login" class="btn btn-outline-info btn-custom" style="width: 100%; margin-bottom: 10px;">
                                        <i class="fas fa-comments"></i> Trò chuyện
                                    </a>
                                }
                                else
                                {
                                    <button type="button" class="btn btn-outline-info btn-custom" data-toggle="modal" data-target="#chatModal" style="width: 100%; margin-bottom: 10px;">
                                        <i class="fas fa-comments"></i> Trò chuyện
                                    </button>
                                }
                            </div>


                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Job Post Details End -->
        
        <!-- Chat Modal -->
        <div class="modal fade" id="chatModal" tabindex="-1" role="dialog" aria-labelledby="chatModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
                <div class="modal-body modal-content" style="background-color:transparent">
                    <div class="page-content page-container" id="page-content">
                        <div class="padding">
                            <div class="row container d-flex justify-content-center">
                                <div class="col-md-12">
                                    <div class="card card-bordered shadow-sm">
                                        <div class="card-header d-flex align-items-center justify-content-between">
                                            <h4 class="card-title"><strong>Chat</strong></h4>
                                            <a class="btn btn-xs btn-secondary" asp-area="User" asp-controller="UserChat" asp-action="Index" data-abc="true">@Model.CompanyName</a>
                                            <button type="button" class="btn btn-danger btn-sm" data-dismiss="modal" aria-label="Close">
                                                Close
                                            </button>
                                        </div>

                                        <div class="ps-container ps-theme-default ps-active-y" id="chat-content" style="overflow-y: scroll !important; height:400px !important;">
                                        </div>

                                        <!-- Chat Input Area -->
                                        <div class="publisher bt-1 border-light d-flex align-items-center mt-2">
                                            @if (Model.UserLogo != null && Model.UserLogo.Length > 0)
                                            {
                                                <img class="avatar avatar-xs rounded-circle" src="data:image/png;base64,@Convert.ToBase64String(Model.UserLogo)" alt="User Logo" style="width: 40px; height: 40px;">
                                            }
                                            else
                                            {
                                                <img class="avatar avatar-xs rounded-circle" src="/img/logo/UserLogo.png" alt="Default User Logo" style="width: 40px; height: 40px;">
                                            }

                                            <input class="publisher-input form-control ml-3" type="text" placeholder="Write a message..." id="chatMessage" style="border-radius: 20px; padding: 10px;">
                                            @* <span class="publisher-btn file-group ml-2">
                                                <i class="fa fa-paperclip file-browser text-muted"></i>
                                                <input type="file">
                                            </span> *@
                                            @* <a class="publisher-btn text-muted ml-2" href="#" data-abc="true"><i class="fa fa-smile"></i></a> *@
                                            <a class="publisher-btn text-info ml-2" href="#" data-abc="true" id="sendMessageButton"><i class="fa fa-paper-plane"></i></a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Employer Information Modal -->
        <div class="modal fade employer-info-modal" id="employerInfoModalRenamed" tabindex="-1" role="dialog" aria-labelledby="employerInfoModalRenamedLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document" style="display: flex; align-items: center; justify-content: center;">
                <div class="modal-content rounded-lg border-0 shadow p-4" style="width: 100%; max-width: 1200px; min-width: 1200px;">

                    <!-- Header -->
                    <div class="modal-header border-0 p-4 text-white" style="background: linear-gradient(135deg, #f00000, #dc281e); border-radius: 8px 8px 0 0;">
                        <h4 class="modal-title font-weight-bold text-white" id="employerInfoModalRenamedLabel">Thông Tin Nhà Tuyển Dụng</h4>
                        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close" style="opacity: 1;">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>

                    <!-- Body -->
                    <div class="modal-bodyEmployer px-5 py-4" style="background-color: #f8f9fa;">
                        <!-- Company Logo and Name -->
                        <div class="text-center mb-4">
                            <img id="employerLogo" src="/images/default-avatar.png" class="img-fluid rounded-circle shadow-sm border" alt="Employer Logo" style="width: 120px; height: 120px;" />
                            <p class="font-weight-bold mt-3" id="employerName" style="font-size: 1.3rem; color: #333;">Chưa cung cấp</p>
                        </div>

                        <!-- Company Introduction Section -->
                        <div class="w-100 mb-4">
                            <div class="card border-0 shadow-sm p-4" style="border-radius: 10px;">
                                <h6 class="section-header">Giới Thiệu Công Ty</h6>
                                <p id="employerDescription" class="text-dark mb-0" style="line-height: 1.6;">
                                    Chưa cung cấp
                                </p>
                            </div>
                        </div>

                        <!-- Contact Information Section -->
                        <div class="w-100 mb-4">
                            <div class="card border-0 shadow-sm p-4" style="border-radius: 10px;">
                                <h6 class="section-header">Thông Tin Liên Hệ</h6>
                                <div class="row text-dark">
                                    <div class="col-md-6 mb-2">
                                        <p><strong>Email:</strong> <span id="employerEmail">Chưa cung cấp</span></p>
                                        <p><strong>Địa Chỉ:</strong> <span id="employerAddress">Chưa cung cấp</span></p>
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <p><strong>Số Điện Thoại:</strong> <span id="employerPhone">Chưa cung cấp</span></p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Social Links Section -->
                        <div class="my-4">
                            <div class="card border-0 shadow-sm p-4" style="border-radius: 10px;">
                                <h6 class="section-header">Liên Kết Mạng Xã Hội</h6>
                                <div class="d-flex justify-content-start gap-3 social-links-container" style="gap: 10px">
                                    <a href="#" target="_blank" id="employerFacebook" class="social-link bg-facebook d-flex align-items-center justify-content-center rounded-circle" aria-label="Facebook">
                                        <i class="fab fa-facebook-f"></i>
                                    </a>
                                    <a href="#" target="_blank" id="employerTwitter" class="social-link bg-twitter d-flex align-items-center justify-content-center rounded-circle" aria-label="Twitter">
                                        <i class="fab fa-twitter"></i>
                                    </a>
                                    <a href="#" target="_blank" id="employerLinkedIn" class="social-link bg-linkedin d-flex align-items-center justify-content-center rounded-circle" aria-label="LinkedIn">
                                        <i class="fab fa-linkedin-in"></i>
                                    </a>
                                    <a href="#" target="_blank" id="employerInstagram" class="social-link bg-instagram d-flex align-items-center justify-content-center rounded-circle" aria-label="Instagram">
                                        <i class="fab fa-instagram"></i>
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- Job List Section -->
                        <div class="w-100 mt-4">
                            <div class="card border-0 shadow-sm p-4" style="border-radius: 10px;">
                                <h6 class="section-header">Danh Sách Công Việc</h6>
                                <div id="employerJobs" class="job-cards">
                                    <!-- Job cards will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Job Post Details End -->
        
        <!-- Chat Modal -->
        <div class="modal fade" id="chatModal" tabindex="-1" role="dialog" aria-labelledby="chatModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
                <div class="modal-body modal-content" style="background-color:transparent">
                    <div class="page-content page-container" id="page-content">
                        <div class="padding">
                            <div class="row container d-flex justify-content-center">
                                <div class="col-md-12">
                                    <div class="card card-bordered shadow-sm">
                                        <div class="card-header d-flex align-items-center justify-content-between">
                                            <h4 class="card-title"><strong>Chat</strong></h4>
                                            <a class="btn btn-xs btn-secondary" asp-area="User" asp-controller="UserChat" asp-action="Index" data-abc="true">@Model.CompanyName</a>
                                            <button type="button" class="btn btn-danger btn-sm" data-dismiss="modal" aria-label="Close">
                                                Close
                                            </button>
                                        </div>

                                        <div class="ps-container ps-theme-default ps-active-y" id="chat-content" style="overflow-y: scroll !important; height:400px !important;">
                                        </div>

                                        <!-- Chat Input Area -->
                                        <div class="publisher bt-1 border-light d-flex align-items-center mt-2">
                                            @if (Model.UserLogo != null && Model.UserLogo.Length > 0)
                                            {
                                                <img class="avatar avatar-xs rounded-circle" src="data:image/png;base64,@Convert.ToBase64String(Model.UserLogo)" alt="User Logo" style="width: 40px; height: 40px;">
                                            }
                                            else
                                            {
                                                <img class="avatar avatar-xs rounded-circle" src="/img/logo/UserLogo.png" alt="Default User Logo" style="width: 40px; height: 40px;">
                                            }

                                            <input class="publisher-input form-control ml-3" type="text" placeholder="Write a message..." id="chatMessage" style="border-radius: 20px; padding: 10px;">
                                            @* <span class="publisher-btn file-group ml-2">
                                                <i class="fa fa-paperclip file-browser text-muted"></i>
                                                <input type="file">
                                            </span> *@
                                            @* <a class="publisher-btn text-muted ml-2" href="#" data-abc="true"><i class="fa fa-smile"></i></a> *@
                                            <a class="publisher-btn text-info ml-2" href="#" data-abc="true" id="sendMessageButton"><i class="fa fa-paper-plane"></i></a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Employer Information Modal -->
        <div class="modal fade employer-info-modal" id="employerInfoModalRenamed" tabindex="-1" role="dialog" aria-labelledby="employerInfoModalRenamedLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document" style="display: flex; align-items: center; justify-content: center;">
                <div class="modal-content rounded-lg border-0 shadow p-4" style="width: 100%; max-width: 1200px; min-width: 1200px;">

                    <!-- Header -->
                    <div class="modal-header border-0 p-4 text-white" style="background: linear-gradient(135deg, #f00000, #dc281e); border-radius: 8px 8px 0 0;">
                        <h4 class="modal-title font-weight-bold text-white" id="employerInfoModalRenamedLabel">Thông Tin Nhà Tuyển Dụng</h4>
                        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close" style="opacity: 1;">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>

                    <!-- Body -->
                    <div class="modal-bodyEmployer px-5 py-4" style="background-color: #f8f9fa;">
                        <!-- Company Logo and Name -->
                        <div class="text-center mb-4">
                            <img id="employerLogo" src="/images/default-avatar.png" class="img-fluid rounded-circle shadow-sm border" alt="Employer Logo" style="width: 120px; height: 120px;" />
                            <p class="font-weight-bold mt-3" id="employerName" style="font-size: 1.3rem; color: #333;">Chưa cung cấp</p>
                        </div>

                        <!-- Company Introduction Section -->
                        <div class="w-100 mb-4">
                            <div class="card border-0 shadow-sm p-4" style="border-radius: 10px;">
                                <h6 class="section-header">Giới Thiệu Công Ty</h6>
                                <p id="employerDescription" class="text-dark mb-0" style="line-height: 1.6;">
                                    Chưa cung cấp
                                </p>
                            </div>
                        </div>

                        <!-- Contact Information Section -->
                        <div class="w-100 mb-4">
                            <div class="card border-0 shadow-sm p-4" style="border-radius: 10px;">
                                <h6 class="section-header">Thông Tin Liên Hệ</h6>
                                <div class="row text-dark">
                                    <div class="col-md-6 mb-2">
                                        <p><strong>Email:</strong> <span id="employerEmail">Chưa cung cấp</span></p>
                                        <p><strong>Địa Chỉ:</strong> <span id="employerAddress">Chưa cung cấp</span></p>
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <p><strong>Số Điện Thoại:</strong> <span id="employerPhone">Chưa cung cấp</span></p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Social Links Section -->
                        <div class="my-4">
                            <div class="card border-0 shadow-sm p-4" style="border-radius: 10px;">
                                <h6 class="section-header">Liên Kết Mạng Xã Hội</h6>
                                <div class="d-flex justify-content-start gap-3 social-links-container" style="gap: 10px">
                                    <a href="#" target="_blank" id="employerFacebook" class="social-link bg-facebook d-flex align-items-center justify-content-center rounded-circle" aria-label="Facebook">
                                        <i class="fab fa-facebook-f"></i>
                                    </a>
                                    <a href="#" target="_blank" id="employerTwitter" class="social-link bg-twitter d-flex align-items-center justify-content-center rounded-circle" aria-label="Twitter">
                                        <i class="fab fa-twitter"></i>
                                    </a>
                                    <a href="#" target="_blank" id="employerLinkedIn" class="social-link bg-linkedin d-flex align-items-center justify-content-center rounded-circle" aria-label="LinkedIn">
                                        <i class="fab fa-linkedin-in"></i>
                                    </a>
                                    <a href="#" target="_blank" id="employerInstagram" class="social-link bg-instagram d-flex align-items-center justify-content-center rounded-circle" aria-label="Instagram">
                                        <i class="fab fa-instagram"></i>
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- Job List Section -->
                        <div class="w-100 mt-4">
                            <div class="card border-0 shadow-sm p-4" style="border-radius: 10px;">
                                <h6 class="section-header">Danh Sách Công Việc</h6>
                                <div id="employerJobs" class="job-cards">
                                    <!-- Job cards will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Các thẻ script giữ nguyên -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- Thêm Bootstrap JS nếu chưa có -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
    <!-- SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

    <!-- SweetAlert2 JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        $(document).ready(function () {
            var receiverId = '@Model.ApplicationUserId';
            var senderId = '@userId'; // Make sure this variable is defined in your Razor page
            var userName = '@Model.UserName';
            var companyName = '@Model.CompanyName';
            var companyLogo = '@(Model.CompanyLogo != null ? Convert.ToBase64String(Model.CompanyLogo) : null)';
            var userLogo = '@(Model.UserLogo != null ? Convert.ToBase64String(Model.UserLogo) : null)';

            $('#chatModal').on('shown.bs.modal', function () {
                if (!receiverId || receiverId.trim() === '') {
                    console.error("Không có ApplicationUserId để tải tin nhắn.");
                    alert("Lỗi: Không thể tải tin nhắn vì không có ApplicationUserId.");
                    return;
                }

                $.get('/api/ChatApi/GetMessageDetail/' + receiverId, function (data) {
                    var chatBox = $('#chat-content');
                    chatBox.empty();

                    // Check if there are any messages
                    if (!data || data.length === 0) {
                        // No messages, show the default welcome message
                        chatBox.append(
                            '<div class="media media-chat">' +
                            '<img class="avatar avatar-xs rounded-circle" src="data:image/png;base64,' + companyLogo + '" alt="Employer Logo" style="width: 40px; height: 40px;">' +
                            '<div class="media-body">' +
                            '<p>Hello, ' + userName + ', we are ' + companyName + '. What can we assist you with today? You can chat with us for any inquiries or support.</p>' +
                            '<p class="meta"><time datetime="2023">' + new Date().toLocaleTimeString() + '</time></p>' +
                            '</div></div>'
                        );
                    } else {
                        // If there are messages, display them
                        data.forEach(function (message) {
                            var isSenderEmployer = message.senderId === receiverId;
                            var avatar = isSenderEmployer
                                ? '<img class="avatar avatar-xs rounded-circle" src="data:image/png;base64,' + (companyLogo || '/img/logo/DefaultCompanyLogo.png') + '" alt="Employer Logo" style="width: 40px; height: 40px;">'
                                : '<img class="avatar avatar-xs rounded-circle" src="data:image/png;base64,' + (userLogo || '/img/logo/DefaultUserLogo.png') + '" alt="User Logo" style="width: 40px; height: 40px;">';

                            chatBox.append(
                                '<div class="media media-chat' + (message.senderId === senderId ? ' media-chat-reverse' : '') + '">' +
                                avatar +
                                '<div class="media-body">' +
                                '<p>' + message.content + '</p>' +
                                '<p class="meta"><time datetime="2023">' + new Date(message.sentAt).toLocaleTimeString() + '</time></p>' +
                                '</div></div>'
                            );
                        });
                    }
                }).fail(function (xhr, status, error) {
                    console.error("Lỗi khi tải tin nhắn: " + status);
                    alert("Lỗi khi tải tin nhắn: " + xhr.responseText);
                });
            });

            $('#sendMessageButton').on('click', function () {
                var message = $('#chatMessage').val().trim();

                if (message !== '') {
                    $.ajax({
                        url: '/api/ChatApi/SendMessageToEmployer',
                        method: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify({ ReceiverId: receiverId, Message: message }),
                        success: function () {
                            $('#chat-content').append('<div class="media media-chat media-chat-reverse">' +
                                '<img class="avatar avatar-xs rounded-circle" src="data:image/png;base64,' + (userLogo || '/img/logo/DefaultUserLogo.png') + '" alt="Default User Logo" style="width: 40px; height: 40px;">' +
                                '<div class="media-body">' +
                                '<p>' + message + '</p>' +
                                '<p class="meta"><time datetime="2023">' + new Date().toLocaleTimeString() + '</time></p>' +
                                '</div></div>');
                            $('#chatMessage').val('');  // Clear the message after sending
                        },
                        error: function (xhr, status, error) {
                            console.log("Error status: " + status);
                            console.log("Error details: " + xhr.responseText);
                            alert("Error sending message: " + xhr.responseText);
                        }
                    });
                } else {
                    alert("Please enter a message before sending.");
                }
            });

            function showEmployerInfo(employerId) {
                $('#employerDetailsModal').modal('show');

                // Fetch employer information and display in the modal
                $.ajax({
                    url: '/api/Employer/GetEmployerInfo/' + employerId,
                    method: 'GET',
                    success: function (data) {
                        $('#employerDetailsContent').html(`
                        <h4>${data.name}</h4>
                        <p><strong>Email:</strong> ${data.email}</p>
                        <p><strong>Phone:</strong> ${data.phone}</p>
                        <p><strong>Description:</strong> ${data.description}</p>
                    `);
                    },
                    error: function () {
                        $('#employerDetailsContent').html('<p>Error loading employer information.</p>');
                    }
                });
            }
        });
    </script>

    <script>
        function loadEmployerInfo(employerId) {
    console.log("Employer ID:", employerId); // Kiểm tra giá trị employerId

    // Xóa nội dung cũ
    $('#employerJobs').html('<div>Đang tải thông tin công ty...</div>');
    $('#employerInfoModalRenamed .modal-bodyEmployer').find('.alert').remove(); // Xóa thông báo lỗi cũ

    $.ajax({
        url: '/User/UserJob/GetEmployerInfo',
        type: 'GET',
        data: { employerId: employerId },
        success: function (data) {
            console.log("Response Data:", data); // Kiểm tra dữ liệu trả về

            if (data.error) {
                $('#employerInfoModalRenamed .modal-bodyEmployer').prepend(`
                    <div class="alert alert-danger" role="alert">
                        ${data.error}
                    </div>
                `);
                $('#employerJobs').html('<div>Không có công việc nào được đăng bởi nhà tuyển dụng này.</div>');
            } else {
                // Cập nhật thông tin công ty
                $('#employerLogo').attr('src', data.photo ? `data:image/png;base64,${data.photo}` : '/images/default-avatar.png');
                $('#employerName').text(data.name || 'Chưa cung cấp');
                $('#employerEmail').text(data.email || 'Chưa cung cấp');
                $('#employerPhone').text(data.phone || 'Chưa cung cấp');
                $('#employerAddress').text(data.address || 'Chưa cung cấp');
                $('#employerDescription').text(data.description || 'Chưa cung cấp');

                // Cập nhật các liên kết mạng xã hội
                $('#employerFacebook').attr('href', data.facebookLink || '#').toggle(data.facebookLink);
                $('#employerTwitter').attr('href', data.twitterLink || '#').toggle(data.twitterLink);
                $('#employerLinkedIn').attr('href', data.linkedInLink || '#').toggle(data.linkedInLink);
                $('#employerInstagram').attr('href', data.instagramLink || '#').toggle(data.instagramLink);

                // Cập nhật danh sách công việc
                let jobHtml = '';
                if (data.jobs && data.jobs.length > 0) {
                    data.jobs.forEach(job => {
                        const formattedSalary = job.salaryMin
                            ? `${new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(job.salaryMin)} - ${new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(job.salaryMax || job.salaryMin)}`
                            : 'N/A';

                        jobHtml += `
                            <a href="/User/UserJob/JobDetail/${job.id}" class="job-card-link">
                                <div class="job-card">
                                    <div class="job-card-icon">
                                        <i class="fas fa-briefcase"></i>
                                    </div>
                                    <div class="job-card-content">
                                        <p class="job-title">${job.jobTitle || 'Chưa cung cấp'}</p>
                                        <p class="job-salary">Lương: ${formattedSalary}</p>
                                        <p class="job-working-time">Thời gian làm việc: ${job.workingTime || 'Chưa cung cấp'}</p>
                                        <p class="job-address">Địa Chỉ: ${job.address || 'Chưa cung cấp'}</p>
                                    </div>
                                </div>
                            </a>`;
                    });
                } else {
                    jobHtml = '<div>Chưa có công việc nào được đăng bởi nhà tuyển dụng này.</div>';
                }
                $('#employerJobs').html(jobHtml);
            }
        },
        error: function (xhr, status, error) {
            console.error("Lỗi khi tải thông tin nhà tuyển dụng:", error);
            $('#employerInfoModalRenamed .modal-bodyEmployer').prepend(`
                <div class="alert alert-danger" role="alert">
                    Đã xảy ra lỗi khi tải thông tin nhà tuyển dụng. Vui lòng thử lại sau.
                </div>
            `);
            $('#employerJobs').html('<div>Không có công việc nào được đăng bởi nhà tuyển dụng này.</div>');
        }
    });
}
        function toggleFavorite(jobId) {
            $.ajax({
                url: '/User/UserJob/SaveToFavorites',
                type: 'POST',
                data: { jobId: jobId },
                success: function (response) {
                    if (response.success) {
                        if (response.added) {
                            // Hiển thị thông báo thành công
                            Swal.fire({
                                icon: 'success',
                                title: 'Thành công!',
                                text: response.message,
                                timer: 1500,
                                showConfirmButton: false
                            });

                            // Cập nhật giao diện của nút yêu thích
                            $('#favoriteButton')
                                .html('<i class="fas fa-heart"></i> Đã thêm vào danh sách yêu thích')
                                .removeClass('btn-outline-danger')
                                .addClass('btn-outline-success');
                        } else {
                            // Hiển thị thông báo khi xóa
                            Swal.fire({
                                icon: 'info',
                                title: 'Thông báo',
                                text: response.message,
                                timer: 1500,
                                showConfirmButton: false
                            });

                            // Cập nhật giao diện của nút yêu thích
                            $('#favoriteButton')
                                .html('<i class="far fa-heart"></i> Thêm vào danh sách yêu thích')
                                .removeClass('btn-outline-success')
                                .addClass('btn-outline-danger');
                        }
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Lỗi!',
                            text: response.message
                        });
                    }
                },
                error: function () {
                    Swal.fire({
                        icon: 'error',
                        title: 'Lỗi!',
                        text: 'Đã xảy ra lỗi trong quá trình xử lý. Vui lòng thử lại.'
                    });
                }
            });
        }



    </script>
</body>
</html>
